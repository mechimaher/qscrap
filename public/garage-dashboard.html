<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QScrap Garage Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/assets/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <!-- Shared CSS (must come before module CSS) -->
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/garage-dashboard.css">
</head>

<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <img src="assets/images/qscrap-logo.png" alt="QScrap" class="auth-logo-img">
                <h1>QScrap</h1>
                <p>Garage Partner Portal</p>
            </div>

            <div class="auth-tabs" style="display: flex; gap: 8px; margin-bottom: 24px;">
                <button class="auth-tab active" onclick="switchAuthTab('login')"
                    style="flex: 1; padding: 12px; border: 2px solid var(--border); background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%); border-radius: 10px; font-weight: 600; color: white; cursor: pointer;">Sign
                    In</button>
                <button class="auth-tab" onclick="switchAuthTab('register')"
                    style="flex: 1; padding: 12px; border: 2px solid var(--border); background: rgba(255,255,255,0.05); border-radius: 10px; font-weight: 600; color: var(--text-secondary); cursor: pointer;">Register</button>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" class="form-control" id="loginPhone" placeholder="+974..." required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>

            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label>Garage Name</label>
                    <input type="text" class="form-control" id="regGarageName" placeholder="Your Garage Name" required>
                </div>
                <div class="form-group">
                    <label>Owner Name</label>
                    <input type="text" class="form-control" id="regOwnerName" placeholder="Owner Full Name" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" class="form-control" id="regPhone" placeholder="+974..." required>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" class="form-control" id="regAddress" placeholder="Garage Location" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" id="regPassword" placeholder="Min 6 characters"
                        required>
                </div>
                <button type="submit" class="btn btn-primary">Create Partner Account</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="assets/images/qscrap-logo.png" alt="QScrap" class="sidebar-logo-img">
                <h2 class="sidebar-brand">QScrap</h2>
                <span class="partner-badge">PARTNER</span>
            </div>
            <div class="sidebar-subtitle">Garage Partner Portal</div>

            <!-- Global Search -->
            <div class="global-search" style="padding: 12px 16px;">
                <div class="search-container" style="position: relative;">
                    <input type="text" id="globalSearchInput" placeholder="Search... (Ctrl+K)"
                        style="width: 100%; padding: 10px 12px 10px 36px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                    <i class="bi bi-search"
                        style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                    <div id="searchResults"
                        style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; margin-top: 4px; max-height: 350px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    </div>
                </div>
            </div>

            <nav class="nav-menu">
                <a class="nav-item active" data-section="dashboard">
                    <i class="bi bi-grid-1x2-fill"></i>
                    Dashboard
                </a>
                <a class="nav-item" data-section="requests">
                    <i class="bi bi-inbox-fill"></i>
                    Live Requests
                    <span class="nav-badge" id="requestBadge">0</span>
                </a>
                <a class="nav-item" data-section="bids">
                    <i class="bi bi-tag-fill"></i>
                    My Bids
                </a>
                <a class="nav-item" data-section="orders">
                    <i class="bi bi-box-seam-fill"></i>
                    Orders
                    <span class="nav-badge dispute-badge" id="disputeBadge"
                        style="background: #f59e0b; display: none;">0</span>
                </a>
                <a class="nav-item" data-section="subscription">
                    <i class="bi bi-credit-card-fill"></i>
                    Subscription
                </a>
                <a class="nav-item" data-section="earnings">
                    <i class="bi bi-wallet-fill"></i>
                    Earnings
                    <span class="nav-badge" id="earningsBadge" style="background: #10b981; display: none;">0</span>
                </a>
                <a class="nav-item" data-section="reviews">
                    <i class="bi bi-star-fill"></i>
                    Reviews
                </a>
                <a class="nav-item" data-section="profile">
                    <i class="bi bi-person-fill"></i>
                    Profile
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">G</div>
                    <div>
                        <div class="user-name" id="userName">Garage Name</div>
                        <div class="user-role">Partner</div>
                    </div>
                </div>

                <!-- Theme Toggle -->
                <div class="theme-toggle" onclick="toggleTheme()">
                    <div class="theme-toggle-label">
                        <i class="bi bi-moon-stars-fill theme-icon theme-icon-moon"></i>
                        <i class="bi bi-sun-fill theme-icon theme-icon-sun"></i>
                        <span id="themeLabel">Dark Mode</span>
                    </div>
                    <div class="theme-switch"></div>
                </div>

                <button class="btn-logout" onclick="logout()">
                    <i class="bi bi-box-arrow-left"></i> Sign Out
                </button>
            </div>
        </aside>

        <!-- Top Header Bar (Premium) -->
        <header class="top-header" id="topHeader">
            <div class="header-left">
                <span class="header-greeting" id="headerGreeting">Welcome back</span>
                <span class="header-subtitle">Garage Partner Portal</span>
            </div>
            <div class="header-right">
                <div class="header-datetime" id="headerDateTime">
                    <i class="bi bi-clock"></i>
                    <span id="liveDateTime">--</span>
                </div>
                <button class="header-btn" onclick="refreshCurrentSection()" title="Refresh (R)" id="refreshBtn">
                    <i class="bi bi-arrow-clockwise" id="refreshIcon"></i>
                </button>
                <button class="header-btn" onclick="showKeyboardShortcuts()" title="Keyboard Shortcuts (?)">
                    <i class="bi bi-keyboard"></i>
                </button>
                <div class="header-notifications">
                    <button class="header-btn notification-btn" onclick="toggleNotifications()" id="notificationBtn">
                        <i class="bi bi-bell"></i>
                        <span class="notification-dot" id="notificationDot" style="display: none;"></span>
                    </button>
                    <div class="notifications-dropdown" id="notificationsDropdown">
                        <div class="notifications-header">
                            <span>Notifications</span>
                            <button class="btn-link" onclick="markAllRead()">Mark all read</button>
                        </div>
                        <div class="notifications-list" id="notificationsList">
                            <div class="notification-empty">
                                <i class="bi bi-bell-slash"></i>
                                <span>No new notifications</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-status" title="Connection Status" id="connectionStatus">
                    <span class="status-indicator" id="statusIndicator"></span>
                    <span id="statusText">Connected</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Dashboard Section -->
            <section class="section active" id="sectionDashboard">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Real-time
                    </div>
                </div>

                <!-- Premium Stat Cards with Gradients -->
                <div class="stats-grid">
                    <div class="stat-card premium bids-premium clickable" onclick="switchSection('bids')">
                        <div class="stat-icon"><i class="bi bi-tag"></i></div>
                        <div class="stat-value" id="statPendingBids">0</div>
                        <div class="stat-label">Pending Bids</div>
                    </div>
                    <div class="stat-card premium orders-premium clickable" onclick="switchSection('orders')">
                        <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
                        <div class="stat-value" id="statAcceptedBids">0</div>
                        <div class="stat-label">Accepted This Month</div>
                    </div>
                    <div class="stat-card premium revenue-premium clickable" onclick="switchSection('orders')">
                        <div class="stat-icon"><i class="bi bi-box-seam"></i></div>
                        <div class="stat-value" id="statActiveOrders">0</div>
                        <div class="stat-label">Active Orders</div>
                    </div>
                    <div class="stat-card premium earnings-premium clickable" onclick="switchSection('earnings')">
                        <div class="stat-icon"><i class="bi bi-currency-dollar"></i></div>
                        <div class="stat-value" id="statRevenue">0</div>
                        <div class="stat-label">Revenue (QAR)</div>
                    </div>
                </div>

                <!-- Quick Actions Panel -->
                <div class="quick-actions">
                    <h3><i class="bi bi-lightning-charge"></i> Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="switchSection('requests')">
                            <i class="bi bi-inbox"></i> View Live Requests
                        </button>
                        <button class="action-btn" onclick="switchSection('orders')">
                            <i class="bi bi-box-seam"></i> Manage Orders
                        </button>
                        <button class="action-btn" onclick="switchSection('earnings')">
                            <i class="bi bi-wallet"></i> Check Earnings
                        </button>
                        <button class="action-btn" onclick="switchSection('subscription')">
                            <i class="bi bi-credit-card"></i> Subscription
                        </button>
                        <button class="action-btn" onclick="switchSection('profile')">
                            <i class="bi bi-person"></i> Edit Profile
                        </button>
                    </div>
                </div>

                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 class="section-title">Recent Orders</h3>
                    <button id="toggleRecentOrders" onclick="toggleRecentOrdersList()"
                        style="background: none; border: none; color: var(--accent); cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 13px;">
                        <span id="toggleRecentOrdersText">Show more</span>
                        <i id="toggleRecentOrdersIcon" class="bi bi-chevron-down"></i>
                    </button>
                </div>
                <div id="dashboardRecentOrders" class="requests-grid"></div>
            </section>

            <!-- Requests Section -->
            <section class="section" id="sectionRequests">
                <div class="page-header" style="flex-wrap: wrap; gap: 16px;">
                    <h1 class="page-title">Live Requests</h1>
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Real-time
                    </div>
                </div>

                <!-- Request Filter & Sort Controls -->
                <div class="filter-controls"
                    style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; padding: 16px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;">
                    <!-- Urgency Filter -->
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 13px; font-weight: 600; color: var(--text-secondary);">Urgency:</label>
                        <select id="requestUrgencyFilter" onchange="filterRequests()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text-primary); font-size: 13px;">
                            <option value="all">All</option>
                            <option value="high">üî• High</option>
                            <option value="medium">‚ö° Medium</option>
                            <option value="low">‚úì Low</option>
                        </select>
                    </div>

                    <!-- Condition Filter -->
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                        <label
                            style="font-size: 13px; font-weight: 600; color: var(--text-secondary);">Condition:</label>
                        <select id="requestConditionFilter" onchange="filterRequests()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text-primary); font-size: 13px;">
                            <option value="all">All</option>
                            <option value="new">New Only</option>
                            <option value="used">Used Only</option>
                            <option value="any">Any Condition</option>
                        </select>
                    </div>

                    <!-- Sort Options -->
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
                        <label style="font-size: 13px; font-weight: 600; color: var(--text-secondary);">Sort:</label>
                        <select id="requestSortOption" onchange="sortRequests()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text-primary); font-size: 13px;">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="urgency">Most Urgent</option>
                            <option value="bids_low">Fewest Bids</option>
                            <option value="bids_high">Most Bids</option>
                        </select>
                    </div>

                    <!-- Clear Filters Button -->
                    <button onclick="clearRequestFilters()"
                        style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;"
                        onmouseover="this.style.background='var(--danger)'; this.style.color='white'; this.style.borderColor='var(--danger)';"
                        onmouseout="this.style.background='transparent'; this.style.color='var(--text-secondary)'; this.style.borderColor='var(--border)';">
                        <i class="bi bi-x-lg"></i> Clear
                    </button>
                </div>

                <div id="requestsList" class="requests-grid"></div>
                <div id="requestsPagination" style="margin-top: 20px;"></div>
            </section>

            <!-- Bids Section -->
            <section class="section" id="sectionBids">
                <div class="page-header" style="flex-wrap: wrap; gap: 16px;">
                    <h1 class="page-title">My Bids</h1>
                    <div class="filter-tabs" style="display: flex; gap: 8px;">
                        <button class="filter-tab active" data-filter="all" onclick="filterBids('all')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: var(--accent); color: white; cursor: pointer; font-size: 13px; transition: all 0.2s;">All</button>
                        <button class="filter-tab" data-filter="pending" onclick="filterBids('pending')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Pending</button>
                        <button class="filter-tab" data-filter="accepted" onclick="filterBids('accepted')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Accepted</button>
                        <button class="filter-tab" data-filter="rejected" onclick="filterBids('rejected')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Rejected</button>
                    </div>
                </div>
                <div id="bidsList"></div>
                <div id="bidsPagination" style="margin-top: 20px;"></div>
            </section>

            <!-- Orders Section -->
            <section class="section" id="sectionOrders">
                <div class="page-header" style="flex-wrap: wrap; gap: 16px;">
                    <h1 class="page-title">Orders</h1>
                    <div class="filter-tabs" style="display: flex; gap: 8px;">
                        <button class="filter-tab active" data-filter="all" onclick="filterOrders('all')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: var(--accent); color: white; cursor: pointer; font-size: 13px; transition: all 0.2s;">All</button>
                        <button class="filter-tab" data-filter="active" onclick="filterOrders('active')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Active</button>
                        <button class="filter-tab" data-filter="completed" onclick="filterOrders('completed')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Completed</button>
                        <button class="filter-tab" data-filter="cancelled" onclick="filterOrders('cancelled')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Cancelled</button>
                    </div>
                </div>
                <div id="ordersList"></div>
                <div id="ordersPagination" style="margin-top: 20px;"></div>
            </section>

            <!-- Subscription Section -->
            <section class="section" id="sectionSubscription">
                <div class="page-header">
                    <h1 class="page-title">My Subscription</h1>
                </div>

                <!-- Current Plan Card -->
                <div class="subscription-current" id="currentSubscription">
                    <div class="plan-card current">
                        <div class="plan-header">
                            <div class="plan-badge">Current Plan</div>
                            <h3 class="plan-name" id="subPlanName">Loading...</h3>
                        </div>
                        <div class="plan-details">
                            <div class="plan-price">
                                <span class="price-amount" id="subPrice">-</span>
                                <span class="price-period">/month</span>
                            </div>
                            <div class="plan-stats">
                                <div class="plan-stat">
                                    <i class="bi bi-tags"></i>
                                    <span id="subBidsUsed">0</span> / <span id="subBidsLimit">‚àû</span> bids used
                                </div>
                                <div class="plan-stat">
                                    <i class="bi bi-percent"></i>
                                    Commission: <span id="subCommission">-</span>
                                </div>
                                <div class="plan-stat">
                                    <i class="bi bi-calendar"></i>
                                    Renews: <span id="subRenewal">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="plan-actions">
                            <button class="btn btn-outline" onclick="showPlanOptions()">
                                <i class="bi bi-arrow-up-circle"></i> Change Plan
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Available Plans -->
                <div class="plans-grid" id="plansGrid" style="display: none;">
                    <h3 style="grid-column: 1/-1; margin-bottom: 16px;">Available Plans</h3>
                    <!-- Plans loaded dynamically -->
                </div>
            </section>

            <!-- Earnings Section -->
            <section class="section" id="sectionEarnings">
                <div class="page-header">
                    <h1 class="page-title">Earnings & Payouts</h1>
                </div>

                <!-- Earnings Summary -->
                <div class="earnings-summary">
                    <div class="earning-card">
                        <div class="earning-icon pending"><i class="bi bi-clock"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">Pending Payout</span>
                            <span class="earning-value" id="earningsPending">0 QAR</span>
                        </div>
                    </div>
                    <div class="earning-card">
                        <div class="earning-icon processing"><i class="bi bi-hourglass-split"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">Processing</span>
                            <span class="earning-value" id="earningsProcessing">0 QAR</span>
                        </div>
                    </div>
                    <div class="earning-card">
                        <div class="earning-icon completed"><i class="bi bi-check-circle"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">Total Paid</span>
                            <span class="earning-value" id="earningsTotal">0 QAR</span>
                        </div>
                    </div>
                    <div class="earning-card">
                        <div class="earning-icon month"><i class="bi bi-calendar3"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">This Month</span>
                            <span class="earning-value" id="earningsMonth">0 QAR</span>
                        </div>
                    </div>
                </div>

                <!-- Awaiting Confirmation (dynamically populated) -->
                <div id="awaitingConfirmationContainer" style="display: none;"></div>

                <!-- Payout History -->
                <div class="section-card">
                    <div class="section-card-header">
                        <h3><i class="bi bi-list-ul"></i> Payout History</h3>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Order</th>
                                    <th>Gross</th>
                                    <th>Commission</th>
                                    <th>Net</th>
                                    <th>Status</th>
                                    <th>Invoice</th>
                                </tr>
                            </thead>
                            <tbody id="payoutHistory">
                                <tr>
                                    <td colspan="7" class="empty-state">Loading payouts...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="payoutPagination"></div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section class="section" id="sectionReviews">
                <div class="page-header">
                    <h1 class="page-title"><i class="bi bi-star-fill" style="color: #f59e0b;"></i> My Reviews</h1>
                    <p style="color: var(--text-secondary);">See what customers are saying about your service</p>
                </div>

                <!-- Reviews Summary -->
                <div id="reviewsSummary"
                    style="background: var(--bg-card); border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow-sm);">
                    <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                        <i class="bi bi-hourglass-split"></i> Loading reviews...
                    </div>
                </div>

                <!-- Reviews List -->
                <div id="reviewsList" style="display: flex; flex-direction: column; gap: 16px;"></div>
                <div id="reviewsPagination"></div>
            </section>

            <!-- Profile Section -->
            <section class="section" id="sectionProfile">
                <div class="page-header">
                    <h1 class="page-title">My Profile</h1>
                </div>
                <div id="profileContent"></div>
            </section>
        </main>
    </div>

    <!-- Bid Modal -->
    <div class="modal-overlay" id="bidModal" role="dialog" aria-modal="true" aria-labelledby="bidModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="bidModalTitle">Submit Bid</h3>
                <button class="modal-close" onclick="closeBidModal()" aria-label="Close modal">&times;</button>
            </div>
            <form id="bidForm">
                <input type="hidden" id="bidRequestId">
                <p id="bidRequestInfo" style="color: var(--text-secondary); margin-bottom: 20px;"></p>

                <div class="form-group">
                    <label>Price (QAR) *</label>
                    <input type="number" class="form-control" id="bidAmount" required min="1"
                        placeholder="Enter your price">
                </div>
                <div class="form-group">
                    <label>Part Condition *</label>
                    <select class="form-control" id="bidCondition" required>
                        <option value="">Select condition...</option>
                        <option value="new">New</option>
                        <option value="used_excellent">Used - Excellent</option>
                        <option value="used_good">Used - Good</option>
                        <option value="used_fair">Used - Fair</option>
                        <option value="refurbished">Refurbished</option>
                    </select>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Brand (Optional)</label>
                        <input type="text" class="form-control" id="bidBrand" placeholder="e.g. Toyota, Bosch">
                    </div>
                    <div class="form-group">
                        <label>Part Number (Optional)</label>
                        <input type="text" class="form-control" id="bidPartNumber" placeholder="e.g. 123-456-789">
                    </div>
                </div>
                <div class="form-group">
                    <label>Warranty (Days)</label>
                    <input type="number" class="form-control" id="bidWarranty" value="7" required min="0">
                </div>

                <!-- Photo Upload Section -->
                <div class="form-group">
                    <label><i class="bi bi-camera" style="color: var(--accent);"></i> Upload Part Photos
                        <span style="font-weight: 400; color: var(--text-muted);">(Max 10 images, 5MB
                            each)</span></label>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                        Show the customer the actual part you have. Better photos = higher acceptance rate!
                    </p>
                    <div class="bid-photo-upload" id="bidPhotoUpload"
                        onclick="document.getElementById('bidPhotoInput').click()">
                        <i class="bi bi-images" style="font-size: 32px; color: var(--accent); margin-bottom: 8px;"></i>
                        <span>Click to add photos</span>
                        <span id="photoCounter" style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">0 /
                            10 photos</span>
                    </div>
                    <input type="file" id="bidPhotoInput" accept="image/jpeg,image/png,image/webp,image/gif" multiple
                        style="display: none;">
                    <div class="bid-photo-grid" id="bidPhotoGrid"></div>
                </div>

                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea class="form-control" id="bidNotes" rows="2"
                        placeholder="Part number, compatibility info, delivery estimate..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary"><i class="bi bi-send"></i> Submit Bid</button>
            </form>
        </div>
    </div>

    <!-- Counter-Offer Respond Modal -->
    <div class="counter-respond-modal" id="counterRespondModal" role="dialog" aria-modal="true"
        aria-label="Customer Counter-Offer">
        <div class="counter-respond-content">
            <div class="counter-respond-header">
                <h3>üí∞ Customer Counter-Offer</h3>
                <button class="counter-respond-close" onclick="closeCounterRespondModal()">√ó</button>
            </div>
            <div class="counter-respond-body">
                <div class="counter-price-display">
                    <div class="your-bid">
                        <label>Your Bid</label>
                        <div class="price" id="respondYourBid">0 QAR</div>
                    </div>
                    <i class="bi bi-arrow-right" style="font-size: 24px; color: var(--accent);"></i>
                    <div class="customer-offer">
                        <label>Customer Offers</label>
                        <div class="price" id="respondCustomerOffer">0 QAR</div>
                    </div>
                </div>

                <div class="counter-message-display" id="respondCustomerMessage" style="display: none;">
                    "Customer message here"
                </div>

                <div class="counter-respond-actions">
                    <button class="counter-respond-btn accept" onclick="respondToCounter('accept')">
                        <i class="bi bi-check-circle"></i>
                        Accept
                    </button>
                    <button class="counter-respond-btn reject" onclick="respondToCounter('reject')">
                        <i class="bi bi-x-circle"></i>
                        Decline
                    </button>
                    <button class="counter-respond-btn counter" onclick="showCounterInput()">
                        <i class="bi bi-arrow-repeat"></i>
                        Counter
                    </button>
                </div>

                <div class="counter-input-section" id="counterInputSection">
                    <label>Your Counter-Offer Price</label>
                    <div class="counter-input-row">
                        <input type="number" id="garageCounterAmount" placeholder="Enter amount">
                        <button onclick="respondToCounter('counter')">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dispute Response Modal -->
    <div class="counter-respond-modal" id="disputeRespondModal" role="dialog" aria-modal="true"
        aria-label="Customer Dispute">
        <div class="counter-respond-content" style="max-width: 450px;">
            <div class="counter-respond-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <h3>‚ùå≈°¬†√Ø¬∏¬è Customer Dispute</h3>
                <button class="counter-respond-close" onclick="closeDisputeModal()">√ó</button>
            </div>
            <div class="counter-respond-body">
                <div
                    style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                    <div style="font-size: 13px; color: var(--text-secondary);">Order</div>
                    <div id="disputeOrderNumber" style="font-size: 16px; font-weight: 700;"></div>
                </div>

                <div style="margin-bottom: 16px;">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Issue Reason</div>
                    <div id="disputeReason" style="font-size: 15px; font-weight: 600; color: var(--warning);"></div>
                </div>

                <div id="disputeDescription"
                    style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 16px; font-size: 14px; display: none;">
                </div>

                <div id="disputePhotos" style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;"></div>

                <div
                    style="display: flex; justify-content: space-between; padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; margin-bottom: 16px;">
                    <div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Refund Amount</div>
                        <div id="disputeRefundAmount" style="font-size: 18px; font-weight: 700; color: var(--danger);">0
                            QAR</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 12px; color: var(--text-secondary);">Restocking Fee</div>
                        <div id="disputeRestockingFee"
                            style="font-size: 18px; font-weight: 700; color: var(--success);">0 QAR</div>
                    </div>
                </div>

                <div class="counter-respond-actions">
                    <button class="counter-respond-btn accept" onclick="respondToDispute('accept')">
                        <i class="bi bi-check-circle"></i>
                        Accept Return
                    </button>
                    <button class="counter-respond-btn reject" onclick="showContestInput()">
                        <i class="bi bi-x-circle"></i>
                        Contest
                    </button>
                </div>

                <div class="counter-input-section" id="contestInputSection" style="display: none;">
                    <label>Explain why you contest this dispute</label>
                    <textarea class="form-control" id="contestReason" rows="3"
                        placeholder="Provide evidence or explanation..."></textarea>
                    <button class="btn btn-primary" onclick="respondToDispute('contest')"
                        style="width: 100%; margin-top: 12px;">
                        <i class="bi bi-send"></i> Submit Contest
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Professional Lightbox for Image Viewing -->
    <div class="pro-lightbox" id="proLightbox">
        <div class="lightbox-backdrop" onclick="closeLightbox()"></div>
        <div class="lightbox-container">
            <button class="lightbox-close" onclick="closeLightbox()">
                <i class="bi bi-x-lg"></i>
            </button>
            <button class="lightbox-nav prev" id="lightboxPrev" onclick="changeSlide(-1)">
                <i class="bi bi-chevron-left"></i>
            </button>
            <div class="lightbox-content" id="lightboxContent">
                <img id="lightboxImg" src="" alt="Full size image">
            </div>
            <button class="lightbox-nav next" id="lightboxNext" onclick="changeSlide(1)">
                <i class="bi bi-chevron-right"></i>
            </button>
            <div class="lightbox-controls">
                <button onclick="resetZoom()"><i class="bi bi-arrows-angle-contract"></i></button>
                <button onclick="zoomBox(0.25)"><i class="bi bi-zoom-in"></i></button>
                <button onclick="zoomBox(-0.25)"><i class="bi bi-zoom-out"></i></button>
                <span id="lightboxCounter">1 / 1</span>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal-overlay" id="orderDetailModal" role="dialog" aria-modal="true" aria-labelledby="orderDetailTitle">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border);">
                <div>
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 12px;">
                        Order <span id="orderModalNumber" style="color: var(--accent);"></span>
                        <span id="orderModalStatus" class="status-badge"></span>
                    </h2>
                    <div style="color: var(--text-muted); font-size: 13px; margin-top: 4px;">
                        Created: <span id="orderModalDate"></span>
                    </div>
                </div>
                <button onclick="closeOrderModal()"
                    style="background: none; border: none; font-size: 24px; color: var(--text-secondary); cursor: pointer;">&times;</button>
            </div>

            <div class="modal-body" style="padding: 20px;">
                <!-- Customer Info -->
                <div class="info-section" style="margin-bottom: 20px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-person" style="color: var(--accent);"></i> Customer
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>Name:</strong> <span id="orderModalCustomer"></span></div>
                        <div><strong>Phone:</strong> <span id="orderModalCustomerPhone"></span></div>
                    </div>
                </div>

                <!-- Part Details -->
                <div class="info-section"
                    style="margin-bottom: 20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-gear" style="color: var(--accent);"></i> Part Details
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>Vehicle:</strong> <span id="orderModalVehicle"></span></div>
                        <div><strong>Price:</strong> <span id="orderModalPrice"
                                style="color: var(--success); font-weight: 600;"></span></div>
                        <div style="grid-column: 1/-1;"><strong>Part:</strong> <span id="orderModalPart"></span></div>
                        <div><strong>Condition:</strong> <span id="orderModalCondition"></span></div>
                        <div><strong>Warranty:</strong> <span id="orderModalWarranty"></span></div>
                    </div>
                </div>

                <!-- Images Gallery -->
                <div class="info-section" style="margin-bottom: 20px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-images" style="color: var(--accent);"></i> Photos
                    </h4>
                    <div id="orderModalImages" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                </div>

                <!-- Status Timeline -->
                <div class="info-section" style="margin-bottom: 20px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-clock-history" style="color: var(--accent);"></i> Order Timeline
                    </h4>
                    <div id="orderModalTimeline" style="padding-left: 20px; border-left: 2px solid var(--border);">
                    </div>
                </div>

                <!-- Delivery Info (if applicable) -->
                <div class="info-section" id="orderModalDeliverySection"
                    style="display: none; margin-bottom: 20px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1)); padding: 16px; border-radius: 12px;">
                    <h4 style="margin: 0 0 12px; color: var(--success); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-truck"></i> Delivery Info
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>Driver:</strong> <span id="orderModalDriver"></span></div>
                        <div><strong>Status:</strong> <span id="orderModalDeliveryStatus"></span></div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="info-section" id="orderModalNotesSection" style="display: none;">
                    <h4 style="margin: 0 0 8px; color: var(--text-primary);">
                        <i class="bi bi-sticky" style="color: var(--accent);"></i> Bid Notes
                    </h4>
                    <p id="orderModalNotes" style="color: var(--text-secondary); font-size: 14px; margin: 0;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal-overlay" id="keyboardShortcutsModal" style="align-items: center; justify-content: center;">
        <div class="shortcuts-modal">
            <div class="shortcuts-header">
                <h3><i class="bi bi-keyboard"></i> Keyboard Shortcuts</h3>
                <button class="close-btn" onclick="closeKeyboardShortcuts()">&times;</button>
            </div>
            <div class="shortcuts-grid">
                <div class="shortcuts-section">
                    <h4>Navigation</h4>
                    <div class="shortcut-item">
                        <span>Dashboard</span>
                        <kbd>1</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Live Requests</span>
                        <kbd>2</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>My Bids</span>
                        <kbd>3</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Orders</span>
                        <kbd>4</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Subscription</span>
                        <kbd>5</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Earnings</span>
                        <kbd>6</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Profile</span>
                        <kbd>7</kbd>
                    </div>
                </div>
                <div class="shortcuts-section">
                    <h4>Actions</h4>
                    <div class="shortcut-item">
                        <span>Refresh</span>
                        <kbd>R</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Show shortcuts</span>
                        <kbd>?</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Close modals</span>
                        <kbd>Esc</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Focus search</span>
                        <div><kbd>Ctrl</kbd> + <kbd>K</kbd></div>
                    </div>
                </div>
            </div>
            <div class="shortcuts-footer">
                <button class="btn btn-primary" onclick="closeKeyboardShortcuts()">Got it</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <!-- Shared JS utilities (must come before module JS) -->
    <script src="js/shared/utils.js"></script>
    <script src="js/shared/toast.js"></script>
    <script src="js/shared/modal.js"></script>
    <script src="js/pagination-utils.js"></script>
    <script src="js/garage-dashboard.js"></script>
</body>

</html>