<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QScrap Garage Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/assets/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <!-- Chart.js for Analytics -->
    <script src="/js/chart.min.js"></script>
    <!-- Shared CSS (must come before module CSS) -->
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/garage-dashboard.css">
</head>

<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <img src="assets/images/qscrap-logo.png" alt="QScrap" class="auth-logo-img">
                <h1>QScrap</h1>
                <p>Garage Partner Portal</p>
            </div>

            <div class="auth-tabs" style="display: flex; gap: 8px; margin-bottom: 24px;">
                <button class="auth-tab active" onclick="switchAuthTab('login')"
                    style="flex: 1; padding: 12px; border: 2px solid var(--border); background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%); border-radius: 10px; font-weight: 600; color: white; cursor: pointer;">Sign
                    In</button>
                <button class="auth-tab" onclick="switchAuthTab('register')"
                    style="flex: 1; padding: 12px; border: 2px solid var(--border); background: rgba(255,255,255,0.05); border-radius: 10px; font-weight: 600; color: var(--text-secondary); cursor: pointer;">Register</button>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" class="form-control" id="loginPhone" placeholder="+974..." required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>

            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label>Garage Name</label>
                    <input type="text" class="form-control" id="regGarageName" placeholder="Your Garage Name" required>
                </div>
                <div class="form-group">
                    <label>Owner Name</label>
                    <input type="text" class="form-control" id="regOwnerName" placeholder="Owner Full Name" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" class="form-control" id="regPhone" placeholder="+974..." required>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" class="form-control" id="regAddress" placeholder="Garage Location" required>
                </div>

                <!-- Specialization Section -->
                <div
                    style="background: rgba(99, 102, 241, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                    <h4 style="margin: 0 0 12px; font-size: 14px; color: var(--accent);">
                        <i class="bi bi-gear"></i> Specialization (helps match you with relevant requests)
                    </h4>

                    <!-- Supplier Type -->
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label style="font-size: 13px;">What type of parts do you sell?</label>
                        <select class="form-control" id="regSupplierType" required>
                            <option value="used">Used Parts Only</option>
                            <option value="new">New Parts Only</option>
                            <option value="both">Both Used & New</option>
                        </select>
                    </div>

                    <!-- Brand Specialization -->
                    <div class="form-group" style="margin-bottom: 8px;">
                        <label style="font-size: 13px; display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="regAllBrands" checked onchange="toggleBrandSelection()">
                            I deal with all car brands
                        </label>
                    </div>

                    <div id="brandSelectionContainer" style="display: none;">
                        <label style="font-size: 13px; margin-bottom: 8px; display: block;">Select brands you specialize
                            in:</label>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; font-size: 12px;">
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Toyota"> Toyota</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Nissan"> Nissan</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Honda"> Honda</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Hyundai"> Hyundai</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Kia"> Kia</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Mitsubishi"> Mitsubishi</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Lexus"> Lexus</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="BMW"> BMW</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Mercedes"> Mercedes</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Chevrolet"> Chevrolet</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Ford"> Ford</label>
                            <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox"
                                    class="brand-checkbox" value="Land Rover"> Land Rover</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" id="regPassword" placeholder="Min 6 characters"
                        required>
                </div>
                <button type="submit" class="btn btn-primary">Create Partner Account</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="assets/images/qscrap-logo.png" alt="QScrap" class="sidebar-logo-img">
                <h2 class="sidebar-brand">QScrap</h2>
                <span class="partner-badge">PARTNER</span>
            </div>
            <div class="sidebar-subtitle">Garage Partner Portal</div>

            <!-- Global Search -->
            <div class="global-search" style="padding: 12px 16px;">
                <div class="search-container" style="position: relative;">
                    <input type="text" id="globalSearchInput" placeholder="Search... (Ctrl+K)"
                        style="width: 100%; padding: 10px 12px 10px 36px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                    <i class="bi bi-search"
                        style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                    <div id="searchResults"
                        style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; margin-top: 4px; max-height: 350px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    </div>
                </div>
            </div>

            <nav class="nav-menu">
                <a class="nav-item active" data-section="dashboard">
                    <i class="bi bi-grid-1x2-fill"></i>
                    Dashboard
                </a>
                <a class="nav-item" data-section="requests">
                    <i class="bi bi-inbox-fill"></i>
                    Live Requests
                    <span class="nav-badge" id="requestBadge">0</span>
                </a>
                <a class="nav-item" data-section="bids">
                    <i class="bi bi-tag-fill"></i>
                    My Bids
                    <span class="nav-badge" id="bidsBadge" style="background: #f59e0b; display: none;">0</span>
                </a>
                <a class="nav-item" data-section="pending-actions">
                    <i class="bi bi-lightning-charge-fill"></i>
                    Pending Actions
                    <span class="nav-badge pulse-badge" id="pendingActionsBadge"
                        style="background: linear-gradient(135deg, #ef4444 0%, #f97316 100%); display: none;">0</span>
                </a>
                <a class="nav-item" data-section="orders">
                    <i class="bi bi-box-seam-fill"></i>
                    Orders
                    <span class="nav-badge dispute-badge" id="disputeBadge"
                        style="background: #f59e0b; display: none;">0</span>
                </a>
                <a class="nav-item" data-section="subscription">
                    <i class="bi bi-credit-card-fill"></i>
                    Subscription
                </a>
                <a class="nav-item" data-section="analytics" id="navAnalytics">
                    <i class="bi bi-graph-up-arrow"></i>
                    Analytics
                    <span class="nav-badge" id="analyticsPlanBadge"
                        style="background: linear-gradient(135deg, #8b5cf6, #6366f1); font-size: 9px;">PRO+</span>
                </a>
                <a class="nav-item" data-section="catalog" id="navCatalog">
                    <i class="bi bi-shop"></i>
                    Catalog
                    <span class="nav-badge"
                        style="background: linear-gradient(135deg, #8b5cf6, #6366f1); font-size: 9px;">PRO</span>
                </a>
                <a class="nav-item" data-section="earnings">
                    <i class="bi bi-wallet-fill"></i>
                    Earnings
                    <span class="nav-badge" id="earningsBadge" style="background: #10b981; display: none;">0</span>
                </a>
                <a class="nav-item" data-section="reviews">
                    <i class="bi bi-star-fill"></i>
                    Reviews
                </a>
                <a class="nav-item" data-section="profile">
                    <i class="bi bi-person-fill"></i>
                    Profile
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">G</div>
                    <div>
                        <div class="user-name" id="userName">Garage Name</div>
                        <div class="user-role">Partner</div>
                    </div>
                </div>

                <!-- Theme Toggle -->
                <div class="theme-toggle" onclick="toggleTheme()">
                    <div class="theme-toggle-label">
                        <i class="bi bi-moon-stars-fill theme-icon theme-icon-moon"></i>
                        <i class="bi bi-sun-fill theme-icon theme-icon-sun"></i>
                        <span id="themeLabel">Dark Mode</span>
                    </div>
                    <div class="theme-switch"></div>
                </div>

                <button class="btn-logout" onclick="logout()">
                    <i class="bi bi-box-arrow-left"></i> Sign Out
                </button>
            </div>
        </aside>

        <!-- Top Header Bar (Premium) -->
        <header class="top-header" id="topHeader">
            <div class="header-left">
                <span class="header-greeting" id="headerGreeting">Welcome back</span>
                <span class="header-subtitle">Garage Partner Portal</span>
            </div>
            <div class="header-right">
                <div class="header-datetime" id="headerDateTime">
                    <i class="bi bi-clock"></i>
                    <span id="liveDateTime">--</span>
                </div>
                <button class="header-btn" onclick="refreshCurrentSection()" title="Refresh (R)" id="refreshBtn">
                    <i class="bi bi-arrow-clockwise" id="refreshIcon"></i>
                </button>
                <button class="header-btn" onclick="showKeyboardShortcuts()" title="Keyboard Shortcuts (?)">
                    <i class="bi bi-keyboard"></i>
                </button>
                <div class="header-notifications">
                    <button class="header-btn notification-btn" onclick="toggleNotifications()" id="notificationBtn">
                        <i class="bi bi-bell"></i>
                        <span class="notification-dot" id="notificationDot" style="display: none;"></span>
                    </button>
                    <div class="notifications-dropdown" id="notificationsDropdown">
                        <div class="notifications-header">
                            <span>Notifications</span>
                            <button class="btn-link" onclick="markAllRead()">Mark all read</button>
                        </div>
                        <div class="notifications-list" id="notificationsList">
                            <div class="notification-empty">
                                <i class="bi bi-bell-slash"></i>
                                <span>No new notifications</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-status" title="Connection Status" id="connectionStatus">
                    <span class="status-indicator" id="statusIndicator"></span>
                    <span id="statusText">Connected</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Dashboard Section -->
            <section class="section active" id="sectionDashboard">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Real-time
                    </div>
                </div>

                <!-- Premium Stat Cards with Gradients -->
                <div class="stats-grid">
                    <div class="stat-card premium bids-premium clickable" onclick="switchSection('bids')">
                        <div class="stat-icon"><i class="bi bi-tag"></i></div>
                        <div class="stat-value" id="statPendingBids">0</div>
                        <div class="stat-label">Pending Bids</div>
                    </div>
                    <div class="stat-card premium orders-premium clickable" onclick="switchSection('orders')">
                        <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
                        <div class="stat-value" id="statAcceptedBids">0</div>
                        <div class="stat-label">Accepted This Month</div>
                    </div>
                    <div class="stat-card premium revenue-premium clickable" onclick="switchSection('orders')">
                        <div class="stat-icon"><i class="bi bi-box-seam"></i></div>
                        <div class="stat-value" id="statActiveOrders">0</div>
                        <div class="stat-label">Active Orders</div>
                    </div>
                    <div class="stat-card premium earnings-premium clickable" onclick="switchSection('earnings')">
                        <div class="stat-icon"><i class="bi bi-currency-dollar"></i></div>
                        <div class="stat-value" id="statRevenue">0</div>
                        <div class="stat-label">Revenue (QAR)</div>
                    </div>
                </div>

                <!-- Quick Actions Panel -->
                <div class="quick-actions">
                    <h3><i class="bi bi-lightning-charge"></i> Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="switchSection('requests')">
                            <i class="bi bi-inbox"></i> View Live Requests
                        </button>
                        <button class="action-btn" onclick="switchSection('orders')">
                            <i class="bi bi-box-seam"></i> Manage Orders
                        </button>
                        <button class="action-btn" onclick="switchSection('earnings')">
                            <i class="bi bi-wallet"></i> Check Earnings
                        </button>
                        <button class="action-btn" onclick="switchSection('subscription')">
                            <i class="bi bi-credit-card"></i> Subscription
                        </button>
                        <button class="action-btn" onclick="switchSection('profile')">
                            <i class="bi bi-person"></i> Edit Profile
                        </button>
                    </div>
                </div>

                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 class="section-title">Recent Orders</h3>
                    <button id="toggleRecentOrders" onclick="toggleRecentOrdersList()"
                        style="background: none; border: none; color: var(--accent); cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 13px;">
                        <span id="toggleRecentOrdersText">Show more</span>
                        <i id="toggleRecentOrdersIcon" class="bi bi-chevron-down"></i>
                    </button>
                </div>
                <div id="dashboardRecentOrders" class="requests-grid"></div>
            </section>

            <!-- Requests Section -->
            <section class="section" id="sectionRequests">
                <div class="page-header" style="flex-wrap: wrap; gap: 16px;">
                    <h1 class="page-title">Live Requests</h1>
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Real-time
                    </div>
                </div>

                <!-- Request Filter & Sort Controls -->
                <div class="filter-controls"
                    style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; padding: 16px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;">
                    <!-- Urgency Filter -->
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 13px; font-weight: 600; color: var(--text-secondary);">Urgency:</label>
                        <select id="requestUrgencyFilter" onchange="filterRequests()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text-primary); font-size: 13px;">
                            <option value="all">All</option>
                            <option value="high">ðŸ”¥ High</option>
                            <option value="medium">âš¡ Medium</option>
                            <option value="low">âœ“ Low</option>
                        </select>
                    </div>

                    <!-- Condition Filter -->
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                        <label
                            style="font-size: 13px; font-weight: 600; color: var(--text-secondary);">Condition:</label>
                        <select id="requestConditionFilter" onchange="filterRequests()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text-primary); font-size: 13px;">
                            <option value="all">All</option>
                            <option value="new">New Only</option>
                            <option value="used">Used Only</option>
                            <option value="any">Any Condition</option>
                        </select>
                    </div>

                    <!-- Sort Options -->
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
                        <label style="font-size: 13px; font-weight: 600; color: var(--text-secondary);">Sort:</label>
                        <select id="requestSortOption" onchange="sortRequests()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text-primary); font-size: 13px;">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="urgency">Most Urgent</option>
                            <option value="bids_low">Fewest Bids</option>
                            <option value="bids_high">Most Bids</option>
                        </select>
                    </div>

                    <!-- Clear Filters Button -->
                    <button onclick="clearRequestFilters()"
                        style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;"
                        onmouseover="this.style.background='var(--danger)'; this.style.color='white'; this.style.borderColor='var(--danger)';"
                        onmouseout="this.style.background='transparent'; this.style.color='var(--text-secondary)'; this.style.borderColor='var(--border)';">
                        <i class="bi bi-x-lg"></i> Clear
                    </button>
                </div>

                <div id="requestsList" class="requests-grid"></div>
                <div id="requestsPagination" style="margin-top: 20px;"></div>
            </section>

            <!-- Bids Section -->
            <section class="section" id="sectionBids">
                <div class="page-header" style="flex-wrap: wrap; gap: 16px;">
                    <h1 class="page-title">My Bids</h1>
                    <div class="filter-tabs" style="display: flex; gap: 8px;">
                        <button class="filter-tab active" data-filter="all" onclick="filterBids('all')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: var(--accent); color: white; cursor: pointer; font-size: 13px; transition: all 0.2s;">All</button>
                        <button class="filter-tab" data-filter="pending" onclick="filterBids('pending')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Pending</button>
                        <button class="filter-tab" data-filter="accepted" onclick="filterBids('accepted')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Accepted</button>
                        <button class="filter-tab" data-filter="rejected" onclick="filterBids('rejected')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Rejected</button>
                    </div>
                </div>
                <div id="bidsList"></div>
                <div id="bidsPagination" style="margin-top: 20px;"></div>
            </section>

            <!-- Pending Actions Section (Counter-Offers & Disputes) -->
            <section class="section" id="sectionPendingActions">
                <div class="page-header">
                    <h1 class="page-title"><i class="bi bi-lightning-charge-fill" style="color: #f97316;"></i> Pending
                        Actions</h1>
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Real-time
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="pending-actions-summary"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div class="summary-card"
                        style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%); border: 1px solid rgba(249, 115, 22, 0.3); border-radius: 16px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div
                                style="width: 48px; height: 48px; background: linear-gradient(135deg, #f97316 0%, #ef4444 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-arrow-repeat" style="font-size: 24px; color: white;"></i>
                            </div>
                            <div>
                                <div id="counterOfferCount"
                                    style="font-size: 28px; font-weight: 700; color: var(--text-primary);">0</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">Counter-Offers</div>
                            </div>
                        </div>
                    </div>
                    <div class="summary-card"
                        style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(234, 179, 8, 0.1) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 16px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div
                                style="width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b 0%, #eab308 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-exclamation-triangle" style="font-size: 24px; color: white;"></i>
                            </div>
                            <div>
                                <div id="disputeCount"
                                    style="font-size: 28px; font-weight: 700; color: var(--text-primary);">0</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">Disputes</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Counter-Offers List -->
                <div id="pendingActionsList" style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="empty-state"
                        style="text-align: center; padding: 60px 20px; background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border);">
                        <i class="bi bi-check-circle"
                            style="font-size: 48px; color: var(--success); margin-bottom: 16px;"></i>
                        <h4 style="margin: 0 0 8px; font-size: 18px; color: var(--text-primary);">All Clear!</h4>
                        <p style="margin: 0; color: var(--text-secondary);">No pending actions right now. Counter-offers
                            and disputes will appear here.</p>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section class="section" id="sectionOrders">
                <div class="page-header" style="flex-wrap: wrap; gap: 16px;">
                    <h1 class="page-title">Orders</h1>
                    <div class="filter-tabs" style="display: flex; gap: 8px;">
                        <button class="filter-tab active" data-filter="all" onclick="filterOrders('all')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: var(--accent); color: white; cursor: pointer; font-size: 13px; transition: all 0.2s;">All</button>
                        <button class="filter-tab" data-filter="active" onclick="filterOrders('active')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Active</button>
                        <button class="filter-tab" data-filter="completed" onclick="filterOrders('completed')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Completed</button>
                        <button class="filter-tab" data-filter="cancelled" onclick="filterOrders('cancelled')"
                            style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 13px; transition: all 0.2s;">Cancelled</button>
                    </div>
                </div>
                <div id="ordersList"></div>
                <div id="ordersPagination" style="margin-top: 20px;"></div>
            </section>

            <!-- Subscription Section -->
            <section class="section" id="sectionSubscription">
                <div class="page-header">
                    <h1 class="page-title">My Subscription</h1>
                </div>

                <!-- Current Plan Card -->
                <div class="subscription-current" id="currentSubscription">
                    <div class="plan-card current">
                        <div class="plan-header">
                            <div class="plan-badge">Current Plan</div>
                            <h3 class="plan-name" id="subPlanName">Loading...</h3>
                        </div>
                        <div class="plan-details">
                            <div class="plan-price">
                                <span class="price-amount" id="subPrice">-</span>
                                <span class="price-period">/month</span>
                            </div>
                            <div class="plan-stats">
                                <div class="plan-stat">
                                    <i class="bi bi-tags"></i>
                                    <span id="subBidsUsed">0</span> / <span id="subBidsLimit">âˆž</span> bids used
                                </div>
                                <div class="plan-stat">
                                    <i class="bi bi-percent"></i>
                                    Commission: <span id="subCommission">-</span>
                                </div>
                                <div class="plan-stat">
                                    <i class="bi bi-calendar"></i>
                                    Renews: <span id="subRenewal">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="plan-actions">
                            <button class="btn btn-outline" onclick="showPlanOptions()">
                                <i class="bi bi-arrow-up-circle"></i> Change Plan
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Available Plans -->
                <div class="plans-grid" id="plansGrid" style="display: none;">
                    <h3 style="grid-column: 1/-1; margin-bottom: 16px;">Available Plans</h3>
                    <!-- Plans loaded dynamically -->
                </div>
            </section>

            <!-- Analytics Section (Pro/Enterprise) -->
            <section class="section" id="sectionAnalytics">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="bi bi-graph-up-arrow"></i> Analytics Dashboard
                        <span class="badge" id="analyticsHeaderBadge"
                            style="background: linear-gradient(135deg, #8b5cf6, #6366f1); font-size: 12px; padding: 4px 10px; border-radius: 12px; margin-left: 8px;">PRO+</span>
                    </h1>
                    <div class="header-actions">
                        <select id="analyticsPeriod" class="form-control" style="width: auto;"
                            onchange="loadAnalytics()">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                        <button class="btn btn-outline" id="exportAnalyticsBtn" onclick="exportAnalytics()"
                            style="display: none;">
                            <i class="bi bi-download"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Upgrade Prompt (shown for Starter plans) -->
                <div id="analyticsUpgradePrompt" class="upgrade-prompt" style="display: none;">
                    <div class="upgrade-content">
                        <i class="bi bi-lock-fill" style="font-size: 48px; color: var(--accent);"></i>
                        <h2>Unlock Business Analytics</h2>
                        <p>Upgrade to Professional or Enterprise to access detailed analytics, revenue trends, bid
                            performance metrics, and more.</p>
                        <div class="upgrade-features">
                            <div class="feature"><i class="bi bi-check-circle-fill"></i> Revenue trend charts</div>
                            <div class="feature"><i class="bi bi-check-circle-fill"></i> Bid acceptance rates</div>
                            <div class="feature"><i class="bi bi-check-circle-fill"></i> Top-performing categories</div>
                            <div class="feature"><i class="bi bi-check-circle-fill"></i> Response time analytics</div>
                        </div>
                        <button class="btn btn-primary btn-lg" onclick="switchSection('subscription')">
                            <i class="bi bi-arrow-up-circle"></i> View Upgrade Options
                        </button>
                    </div>
                </div>

                <!-- Analytics Content (shown for Pro/Enterprise) -->
                <div id="analyticsContent" style="display: none;">
                    <!-- Summary Cards -->
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="bi bi-currency-dollar"></i></div>
                            <div class="stat-info">
                                <div class="stat-value" id="analyticsRevenue">0 QAR</div>
                                <div class="stat-label">Total Revenue</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="bi bi-box-seam"></i></div>
                            <div class="stat-info">
                                <div class="stat-value" id="analyticsOrders">0</div>
                                <div class="stat-label">Orders Completed</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="bi bi-percent"></i></div>
                            <div class="stat-info">
                                <div class="stat-value" id="analyticsAcceptRate">0%</div>
                                <div class="stat-label">Bid Acceptance Rate</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="bi bi-clock"></i></div>
                            <div class="stat-info">
                                <div class="stat-value" id="analyticsResponseTime">0h</div>
                                <div class="stat-label">Avg Response Time</div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="charts-grid"
                        style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <!-- Revenue Trend -->
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="bi bi-graph-up"></i> Revenue Trend</h3>
                            </div>
                            <div class="card-body" style="height: 300px;">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        <!-- Top Categories -->
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="bi bi-pie-chart"></i> Top Categories</h3>
                            </div>
                            <div class="card-body" id="topCategoriesList">
                                <p style="color: var(--text-muted);">Loading...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Bid Performance -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="bi bi-tag"></i> Bid Performance</h3>
                        </div>
                        <div class="card-body">
                            <div class="bid-performance-grid"
                                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                                <div class="perf-stat">
                                    <div class="perf-value" id="analyticsTotalBids">0</div>
                                    <div class="perf-label">Total Bids</div>
                                </div>
                                <div class="perf-stat" style="color: #10b981;">
                                    <div class="perf-value" id="analyticsAcceptedBids">0</div>
                                    <div class="perf-label">Accepted</div>
                                </div>
                                <div class="perf-stat" style="color: #ef4444;">
                                    <div class="perf-value" id="analyticsRejectedBids">0</div>
                                    <div class="perf-label">Rejected</div>
                                </div>
                                <div class="perf-stat" style="color: #f59e0b;">
                                    <div class="perf-value" id="analyticsPendingBids">0</div>
                                    <div class="perf-label">Pending</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enterprise: Customer Insights -->
                    <div class="card" id="customerInsightsCard" style="display: none; margin-top: 24px;">
                        <div class="card-header">
                            <h3><i class="bi bi-people"></i> Customer Insights <span class="badge"
                                    style="background: gold; color: black; font-size: 10px;">ENTERPRISE</span></h3>
                        </div>
                        <div class="card-body" id="customerInsightsContent">
                            <p style="color: var(--text-muted);">Loading customer insights...</p>
                        </div>
                    </div>

                    <!-- Enterprise: Market Insights -->
                    <div class="card" id="marketInsightsCard" style="display: none; margin-top: 24px;">
                        <div class="card-header"
                            style="background: linear-gradient(135deg, rgba(234, 179, 8, 0.1), rgba(245, 158, 11, 0.05));">
                            <h3><i class="bi bi-bar-chart-line"></i> Market Insights <span class="badge"
                                    style="background: linear-gradient(135deg, #eab308, #f59e0b); color: black; font-size: 10px;">ENTERPRISE</span>
                            </h3>
                        </div>
                        <div class="card-body" id="marketInsightsContent">
                            <p style="color: var(--text-muted);">Loading market insights...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Catalog Section (Pro/Enterprise) -->
            <section class="section" id="sectionCatalog">
                <div class="page-header"
                    style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div>
                        <h1 class="page-title">ðŸ“¦ Product Catalog</h1>
                        <p style="color: var(--text-muted); margin: 0;" id="catalogSubtitle">Manage your product
                            listings</p>
                    </div>
                    <button class="btn btn-primary" onclick="openAddProductModal()" id="addProductBtn"
                        style="display: none;">
                        <i class="bi bi-plus-lg"></i> Add Product
                    </button>
                </div>

                <!-- Upgrade Prompt for Starter -->
                <div id="catalogUpgradePrompt" class="card"
                    style="display: none; margin-bottom: 24px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.05)); border: 1px solid rgba(139, 92, 246, 0.3);">
                    <div class="card-body" style="text-align: center; padding: 40px;">
                        <i class="bi bi-shop" style="font-size: 48px; color: #8b5cf6; margin-bottom: 16px;"></i>
                        <h3 style="margin-bottom: 8px;">Unlock Product Catalog</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            List your parts for direct sale. Customers can browse and buy instantly!
                        </p>
                        <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                            <div style="padding: 16px 24px; background: var(--bg-tertiary); border-radius: 12px;">
                                <div style="font-size: 24px; font-weight: 700; color: #8b5cf6;">50</div>
                                <div style="font-size: 12px; color: var(--text-muted);">Products (PRO)</div>
                            </div>
                            <div
                                style="padding: 16px 24px; background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(245, 158, 11, 0.1)); border-radius: 12px; border: 1px solid #eab308;">
                                <div style="font-size: 24px; font-weight: 700; color: #eab308;">âˆž</div>
                                <div style="font-size: 12px; color: var(--text-muted);">Unlimited (Enterprise)</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="switchSection('subscription')"
                            style="margin-top: 24px;">
                            <i class="bi bi-rocket-takeoff"></i> Upgrade Now
                        </button>
                    </div>
                </div>

                <!-- Catalog Content (Pro/Enterprise) -->
                <div id="catalogContent" style="display: none;">
                    <!-- Stats Cards -->
                    <div class="stats-grid"
                        style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); border-radius: 12px; padding: 20px;">
                            <div class="stat-value" id="catalogStatProducts" style="font-size: 32px; font-weight: 800;">
                                0</div>
                            <div class="stat-label" style="color: var(--text-muted);">Products</div>
                        </div>
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05)); border-radius: 12px; padding: 20px;">
                            <div class="stat-value" id="catalogStatViews" style="font-size: 32px; font-weight: 800;">0
                            </div>
                            <div class="stat-label" style="color: var(--text-muted);">Total Views</div>
                        </div>
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(234, 179, 8, 0.05)); border-radius: 12px; padding: 20px;">
                            <div class="stat-value" id="catalogStatInquiries"
                                style="font-size: 32px; font-weight: 800;">0</div>
                            <div class="stat-label" style="color: var(--text-muted);">Inquiries</div>
                        </div>
                        <div class="stat-card"
                            style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(219, 39, 119, 0.05)); border-radius: 12px; padding: 20px;">
                            <div class="stat-value" id="catalogStatRemaining"
                                style="font-size: 32px; font-weight: 800;">0</div>
                            <div class="stat-label" style="color: var(--text-muted);">Slots Left</div>
                        </div>
                    </div>

                    <!-- Filters & Search -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-body" style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                            <div style="flex: 1; min-width: 200px;">
                                <input type="text" id="catalogSearch" placeholder="Search products..."
                                    style="width: 100%; padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary);"
                                    oninput="filterCatalogProducts()">
                            </div>
                            <select id="catalogStatusFilter" onchange="loadCatalogProducts()"
                                style="padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary);">
                                <option value="all">All Status</option>
                                <option value="active">Active</option>
                                <option value="draft">Draft</option>
                                <option value="sold">Sold</option>
                            </select>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div id="catalogProductsGrid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                        <p style="color: var(--text-muted); text-align: center; grid-column: 1/-1;">Loading products...
                        </p>
                    </div>

                    <!-- Empty State -->
                    <div id="catalogEmptyState" style="display: none; text-align: center; padding: 60px 20px;">
                        <i class="bi bi-box-seam"
                            style="font-size: 64px; color: var(--text-muted); margin-bottom: 16px;"></i>
                        <h3 style="margin-bottom: 8px;">No Products Yet</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 24px;">Add your first product to start
                            selling!</p>
                        <button class="btn btn-primary" onclick="openAddProductModal()">
                            <i class="bi bi-plus-lg"></i> Add Your First Product
                        </button>
                    </div>
                </div>
            </section>

            <!-- Add Product Modal -->
            <div id="addProductModal" class="modal-overlay" style="display: none;">
                <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h3><i class="bi bi-plus-circle"></i> <span id="productModalTitle">Add New Product</span></h3>
                        <button class="modal-close" onclick="closeAddProductModal()">Ã—</button>
                    </div>
                    <form id="productForm" onsubmit="saveProduct(event)">
                        <input type="hidden" id="editProductId" value="">

                        <!-- Images -->
                        <div class="form-group">
                            <label>Product Images</label>
                            <div id="productImageDropzone" class="dropzone"
                                style="border: 2px dashed var(--border); border-radius: 12px; padding: 30px; text-align: center; cursor: pointer;"
                                ondrop="handleProductImageDrop(event)" ondragover="event.preventDefault()">
                                <i class="bi bi-cloud-upload" style="font-size: 32px; color: var(--text-muted);"></i>
                                <p style="margin: 8px 0 0; color: var(--text-muted);">Drag & drop images or click to
                                    upload</p>
                                <input type="file" id="productImages" multiple accept="image/*" style="display: none;"
                                    onchange="handleProductImageSelect(event)">
                            </div>
                            <div id="productImagePreviews"
                                style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px;"></div>
                        </div>

                        <!-- Title & Part Number -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>Title *</label>
                                <input type="text" id="productTitle" required
                                    placeholder="e.g., Brake Pads Set - Front">
                            </div>
                            <div class="form-group">
                                <label>Part Number</label>
                                <input type="text" id="productPartNumber" placeholder="e.g., BP-2023">
                            </div>
                        </div>

                        <!-- Brand & Category -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>Brand</label>
                                <input type="text" id="productBrand" placeholder="e.g., Brembo, OEM">
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="productCategory">
                                    <option value="">Select category...</option>
                                    <option value="brakes">Brakes</option>
                                    <option value="engine">Engine Parts</option>
                                    <option value="suspension">Suspension</option>
                                    <option value="electrical">Electrical</option>
                                    <option value="body">Body Parts</option>
                                    <option value="interior">Interior</option>
                                    <option value="accessories">Accessories</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="productDescription" rows="3"
                                placeholder="Describe your product..."></textarea>
                        </div>

                        <!-- Condition & Warranty -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>Condition *</label>
                                <select id="productCondition" required>
                                    <option value="new">New</option>
                                    <option value="used_excellent">Used - Excellent</option>
                                    <option value="used_good">Used - Good</option>
                                    <option value="used_fair">Used - Fair</option>
                                    <option value="refurbished">Refurbished</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Warranty (days)</label>
                                <input type="number" id="productWarranty" value="0" min="0">
                            </div>
                        </div>

                        <!-- Pricing -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>Price (QAR) *</label>
                                <input type="number" id="productPrice" required min="1" step="0.01" placeholder="450">
                            </div>
                            <div class="form-group">
                                <label>Original Price</label>
                                <input type="number" id="productOriginalPrice" min="0" step="0.01" placeholder="550">
                            </div>
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" id="productQuantity" value="1" min="1">
                            </div>
                        </div>

                        <!-- Compatibility -->
                        <div class="form-group">
                            <label>Compatible Vehicles</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px;">
                                <input type="text" id="productMake" placeholder="Make (e.g., Toyota)">
                                <input type="text" id="productModel" placeholder="Model (e.g., Camry)">
                                <input type="number" id="productYearFrom" placeholder="From year">
                                <input type="number" id="productYearTo" placeholder="To year">
                            </div>
                        </div>

                        <!-- Actions -->
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;"
                                onclick="saveProduct(event, 'draft')">
                                <i class="bi bi-file-earmark"></i> Save as Draft
                            </button>
                            <button type="submit" class="btn btn-primary" style="flex: 2;">
                                <i class="bi bi-rocket-takeoff"></i> Publish Product
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Earnings Section -->
            <section class="section" id="sectionEarnings">
                <div class="page-header">
                    <h1 class="page-title">Earnings & Payouts</h1>
                </div>

                <!-- Earnings Summary -->
                <div class="earnings-summary">
                    <div class="earning-card">
                        <div class="earning-icon pending"><i class="bi bi-clock"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">Pending Payout</span>
                            <span class="earning-value" id="earningsPending">0 QAR</span>
                        </div>
                    </div>
                    <div class="earning-card">
                        <div class="earning-icon processing"><i class="bi bi-hourglass-split"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">Processing</span>
                            <span class="earning-value" id="earningsProcessing">0 QAR</span>
                        </div>
                    </div>
                    <div class="earning-card">
                        <div class="earning-icon completed"><i class="bi bi-check-circle"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">Total Paid</span>
                            <span class="earning-value" id="earningsTotal">0 QAR</span>
                        </div>
                    </div>
                    <div class="earning-card">
                        <div class="earning-icon month"><i class="bi bi-calendar3"></i></div>
                        <div class="earning-info">
                            <span class="earning-label">This Month</span>
                            <span class="earning-value" id="earningsMonth">0 QAR</span>
                        </div>
                    </div>
                </div>

                <!-- Awaiting Confirmation (dynamically populated) -->
                <div id="awaitingConfirmationContainer" style="display: none;"></div>

                <!-- Payout History -->
                <div class="section-card">
                    <div class="section-card-header">
                        <h3><i class="bi bi-list-ul"></i> Payout History</h3>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Order</th>
                                    <th>Gross</th>
                                    <th>Commission</th>
                                    <th>Net</th>
                                    <th>Status</th>
                                    <th>Invoice</th>
                                </tr>
                            </thead>
                            <tbody id="payoutHistory">
                                <tr>
                                    <td colspan="7" class="empty-state">Loading payouts...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="payoutPagination"></div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section class="section" id="sectionReviews">
                <div class="page-header">
                    <h1 class="page-title"><i class="bi bi-star-fill" style="color: #f59e0b;"></i> My Reviews</h1>
                    <p style="color: var(--text-secondary);">See what customers are saying about your service</p>
                </div>

                <!-- Reviews Summary -->
                <div id="reviewsSummary"
                    style="background: var(--bg-card); border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow-sm);">
                    <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                        <i class="bi bi-hourglass-split"></i> Loading reviews...
                    </div>
                </div>

                <!-- Reviews List -->
                <div id="reviewsList" style="display: flex; flex-direction: column; gap: 16px;"></div>
                <div id="reviewsPagination"></div>
            </section>

            <!-- Profile Section -->
            <section class="section" id="sectionProfile">
                <div class="page-header">
                    <h1 class="page-title">My Profile</h1>
                </div>
                <div id="profileContent"></div>
            </section>
        </main>
    </div>

    <!-- Bid Modal -->
    <div class="modal-overlay" id="bidModal" role="dialog" aria-modal="true" aria-labelledby="bidModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="bidModalTitle">Submit Bid</h3>
                <button class="modal-close" onclick="closeBidModal()" aria-label="Close modal">&times;</button>
            </div>
            <form id="bidForm">
                <input type="hidden" id="bidRequestId">
                <p id="bidRequestInfo" style="color: var(--text-secondary); margin-bottom: 20px;"></p>

                <div class="form-group">
                    <label>Price (QAR) *</label>
                    <input type="number" class="form-control" id="bidAmount" required min="1"
                        placeholder="Enter your price">
                </div>
                <div class="form-group">
                    <label>Part Condition *</label>
                    <select class="form-control" id="bidCondition" required>
                        <option value="">Select condition...</option>
                        <option value="new">New</option>
                        <option value="used_excellent">Used - Excellent</option>
                        <option value="used_good">Used - Good</option>
                        <option value="used_fair">Used - Fair</option>
                        <option value="refurbished">Refurbished</option>
                    </select>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Brand (Optional)</label>
                        <input type="text" class="form-control" id="bidBrand" placeholder="e.g. Toyota, Bosch">
                    </div>
                    <div class="form-group">
                        <label>Part Number (Optional)</label>
                        <input type="text" class="form-control" id="bidPartNumber" placeholder="e.g. 123-456-789">
                    </div>
                </div>
                <div class="form-group">
                    <label>Warranty (Days)</label>
                    <input type="number" class="form-control" id="bidWarranty" value="7" required min="0">
                </div>

                <!-- Photo Upload Section -->
                <div class="form-group">
                    <label><i class="bi bi-camera" style="color: var(--accent);"></i> Upload Part Photos
                        <span style="font-weight: 400; color: var(--text-muted);">(Max 10 images, 5MB
                            each)</span></label>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                        Show the customer the actual part you have. Better photos = higher acceptance rate!
                    </p>
                    <div class="bid-photo-upload" id="bidPhotoUpload"
                        onclick="document.getElementById('bidPhotoInput').click()">
                        <i class="bi bi-images" style="font-size: 32px; color: var(--accent); margin-bottom: 8px;"></i>
                        <span>Click to add photos</span>
                        <span id="photoCounter" style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">0 /
                            10 photos</span>
                    </div>
                    <input type="file" id="bidPhotoInput" accept="image/jpeg,image/png,image/webp,image/gif" multiple
                        style="display: none;">
                    <div class="bid-photo-grid" id="bidPhotoGrid"></div>
                </div>

                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea class="form-control" id="bidNotes" rows="2"
                        placeholder="Part number, compatibility info, delivery estimate..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary"><i class="bi bi-send"></i> Submit Bid</button>
            </form>
        </div>
    </div>


    <!-- Dispute Response Modal -->
    <div class="counter-respond-modal" id="disputeRespondModal" role="dialog" aria-modal="true"
        aria-label="Customer Dispute">
        <div class="counter-respond-content" style="max-width: 450px;">
            <div class="counter-respond-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <h3>âŒÅ¡Â Ã¯Â¸Â Customer Dispute</h3>
                <button class="counter-respond-close" onclick="closeDisputeModal()">Ã—</button>
            </div>
            <div class="counter-respond-body">
                <div
                    style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                    <div style="font-size: 13px; color: var(--text-secondary);">Order</div>
                    <div id="disputeOrderNumber" style="font-size: 16px; font-weight: 700;"></div>
                </div>

                <div style="margin-bottom: 16px;">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Issue Reason</div>
                    <div id="disputeReason" style="font-size: 15px; font-weight: 600; color: var(--warning);"></div>
                </div>

                <div id="disputeDescription"
                    style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 16px; font-size: 14px; display: none;">
                </div>

                <div id="disputePhotos" style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;"></div>

                <div
                    style="display: flex; justify-content: space-between; padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; margin-bottom: 16px;">
                    <div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Refund Amount</div>
                        <div id="disputeRefundAmount" style="font-size: 18px; font-weight: 700; color: var(--danger);">0
                            QAR</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 12px; color: var(--text-secondary);">Restocking Fee</div>
                        <div id="disputeRestockingFee"
                            style="font-size: 18px; font-weight: 700; color: var(--success);">0 QAR</div>
                    </div>
                </div>

                <div class="counter-respond-actions">
                    <button class="counter-respond-btn accept" onclick="respondToDispute('accept')">
                        <i class="bi bi-check-circle"></i>
                        Accept Return
                    </button>
                    <button class="counter-respond-btn reject" onclick="showContestInput()">
                        <i class="bi bi-x-circle"></i>
                        Contest
                    </button>
                </div>

                <div class="counter-input-section" id="contestInputSection" style="display: none;">
                    <label>Explain why you contest this dispute</label>
                    <textarea class="form-control" id="contestReason" rows="3"
                        placeholder="Provide evidence or explanation..."></textarea>
                    <button class="btn btn-primary" onclick="respondToDispute('contest')"
                        style="width: 100%; margin-top: 12px;">
                        <i class="bi bi-send"></i> Submit Contest
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Professional Lightbox for Image Viewing -->
    <div class="pro-lightbox" id="proLightbox">
        <div class="lightbox-backdrop" onclick="closeLightbox()"></div>
        <div class="lightbox-container">
            <button class="lightbox-close" onclick="closeLightbox()">
                <i class="bi bi-x-lg"></i>
            </button>
            <button class="lightbox-nav prev" id="lightboxPrev" onclick="changeSlide(-1)">
                <i class="bi bi-chevron-left"></i>
            </button>
            <div class="lightbox-content" id="lightboxContent">
                <img id="lightboxImg" src="" alt="Full size image">
            </div>
            <button class="lightbox-nav next" id="lightboxNext" onclick="changeSlide(1)">
                <i class="bi bi-chevron-right"></i>
            </button>
            <div class="lightbox-controls">
                <button onclick="resetZoom()"><i class="bi bi-arrows-angle-contract"></i></button>
                <button onclick="zoomBox(0.25)"><i class="bi bi-zoom-in"></i></button>
                <button onclick="zoomBox(-0.25)"><i class="bi bi-zoom-out"></i></button>
                <span id="lightboxCounter">1 / 1</span>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal-overlay" id="orderDetailModal" role="dialog" aria-modal="true" aria-labelledby="orderDetailTitle">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border);">
                <div>
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 12px;">
                        Order <span id="orderModalNumber" style="color: var(--accent);"></span>
                        <span id="orderModalStatus" class="status-badge"></span>
                    </h2>
                    <div style="color: var(--text-muted); font-size: 13px; margin-top: 4px;">
                        Created: <span id="orderModalDate"></span>
                    </div>
                </div>
                <button onclick="closeOrderModal()"
                    style="background: none; border: none; font-size: 24px; color: var(--text-secondary); cursor: pointer;">&times;</button>
            </div>

            <div class="modal-body" style="padding: 20px;">
                <!-- Customer Info -->
                <div class="info-section" style="margin-bottom: 20px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-person" style="color: var(--accent);"></i> Customer
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>Name:</strong> <span id="orderModalCustomer"></span></div>
                        <div><strong>Phone:</strong> <span id="orderModalCustomerPhone"></span></div>
                    </div>
                </div>

                <!-- Part Details -->
                <div class="info-section"
                    style="margin-bottom: 20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-gear" style="color: var(--accent);"></i> Part Details
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>Vehicle:</strong> <span id="orderModalVehicle"></span></div>
                        <div><strong>Price:</strong> <span id="orderModalPrice"
                                style="color: var(--success); font-weight: 600;"></span></div>
                        <div style="grid-column: 1/-1;"><strong>Part:</strong> <span id="orderModalPart"></span></div>
                        <div><strong>Condition:</strong> <span id="orderModalCondition"></span></div>
                        <div><strong>Warranty:</strong> <span id="orderModalWarranty"></span></div>
                    </div>
                </div>

                <!-- Images Gallery -->
                <div class="info-section" style="margin-bottom: 20px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-images" style="color: var(--accent);"></i> Photos
                    </h4>
                    <div id="orderModalImages" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                </div>

                <!-- Status Timeline -->
                <div class="info-section" style="margin-bottom: 20px;">
                    <h4
                        style="margin: 0 0 12px; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-clock-history" style="color: var(--accent);"></i> Order Timeline
                    </h4>
                    <div id="orderModalTimeline" style="padding-left: 20px; border-left: 2px solid var(--border);">
                    </div>
                </div>

                <!-- Delivery Info (if applicable) -->
                <div class="info-section" id="orderModalDeliverySection"
                    style="display: none; margin-bottom: 20px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1)); padding: 16px; border-radius: 12px;">
                    <h4 style="margin: 0 0 12px; color: var(--success); display: flex; align-items: center; gap: 8px;">
                        <i class="bi bi-truck"></i> Delivery Info
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>Driver:</strong> <span id="orderModalDriver"></span></div>
                        <div><strong>Status:</strong> <span id="orderModalDeliveryStatus"></span></div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="info-section" id="orderModalNotesSection" style="display: none;">
                    <h4 style="margin: 0 0 8px; color: var(--text-primary);">
                        <i class="bi bi-sticky" style="color: var(--accent);"></i> Bid Notes
                    </h4>
                    <p id="orderModalNotes" style="color: var(--text-secondary); font-size: 14px; margin: 0;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal-overlay" id="keyboardShortcutsModal" style="align-items: center; justify-content: center;">
        <div class="shortcuts-modal">
            <div class="shortcuts-header">
                <h3><i class="bi bi-keyboard"></i> Keyboard Shortcuts</h3>
                <button class="close-btn" onclick="closeKeyboardShortcuts()">&times;</button>
            </div>
            <div class="shortcuts-grid">
                <div class="shortcuts-section">
                    <h4>Navigation</h4>
                    <div class="shortcut-item">
                        <span>Dashboard</span>
                        <kbd>1</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Live Requests</span>
                        <kbd>2</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>My Bids</span>
                        <kbd>3</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Orders</span>
                        <kbd>4</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Subscription</span>
                        <kbd>5</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Earnings</span>
                        <kbd>6</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Profile</span>
                        <kbd>7</kbd>
                    </div>
                </div>
                <div class="shortcuts-section">
                    <h4>Actions</h4>
                    <div class="shortcut-item">
                        <span>Refresh</span>
                        <kbd>R</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Show shortcuts</span>
                        <kbd>?</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Close modals</span>
                        <kbd>Esc</kbd>
                    </div>
                    <div class="shortcut-item">
                        <span>Focus search</span>
                        <div><kbd>Ctrl</kbd> + <kbd>K</kbd></div>
                    </div>
                </div>
            </div>
            <div class="shortcuts-footer">
                <button class="btn btn-primary" onclick="closeKeyboardShortcuts()">Got it</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <!-- Shared JS utilities (must come before module JS) -->
    <script src="js/shared/utils.js"></script>
    <script src="js/shared/toast.js"></script>
    <script src="js/shared/modal.js"></script>
    <script src="js/pagination-utils.js"></script>
    <script src="js/garage-dashboard.js"></script>
</body>

</html>